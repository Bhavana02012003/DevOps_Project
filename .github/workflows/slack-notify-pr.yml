name: Notify Slack on PR Assignment and Review

on:
  pull_request:
    types:
      - opened
      - assigned
      - review_requested
      - review_request_removed
      - edited
      - closed

  pull_request_review:
    types:
      - submitted

jobs:
  notify_slack:
    runs-on: ubuntu-latest

    steps:
      - name: Send Slack Notification on PR Assignment
        if: github.event.action == 'assigned' || github.event.action == 'review_requested'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
          PR_NUMBER: "${{ github.event.pull_request.number }}"
          PR_TITLE: "${{ github.event.pull_request.title }}"
          PR_URL: "${{ github.event.pull_request.html_url }}"
          PR_AUTHOR: "${{ github.event.pull_request.user.login }}"
          REVIEWER: "${{ github.event.requested_reviewer.login }}"
        run: |
          curl -X POST -H 'Content-type: application/json' --data '{
            "text": ":wave: *PR Review Requested*\n\nğŸ“Œ *Title:* '"$PR_TITLE"'\nğŸ”¢ *PR Number:* #'"$PR_NUMBER"'\nğŸ“ *Author:* '"$PR_AUTHOR"'\nğŸ‘¤ *Assigned to Reviewer:* '"$REVIEWER"'\nğŸ”— *PR Link:* '"$PR_URL"'"
          }' "$SLACK_WEBHOOK_URL"

      - name: Send Slack Notification on PR Review Submission
        if: github.event_name == 'pull_request_review' && github.event.action == 'submitted'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
          PR_NUMBER: "${{ github.event.pull_request.number }}"
          PR_TITLE: "${{ github.event.pull_request.title }}"
          PR_URL: "${{ github.event.pull_request.html_url }}"
          PR_AUTHOR: "${{ github.event.pull_request.user.login }}"
          REVIEWER: "${{ github.event.review.user.login }}"
          REVIEW_STATE: "${{ github.event.review.state }}"
          REVIEW_BODY: "${{ github.event.review.body }}"
        run: |
          curl -X POST -H 'Content-type: application/json' --data '{
            "text": ":speech_balloon: *PR Review Submitted*\n\nğŸ“Œ *Title:* '"$PR_TITLE"'\nğŸ”¢ *PR Number:* #'"$PR_NUMBER"'\nğŸ“ *Author:* '"$PR_AUTHOR"'\nğŸ‘¤ *Reviewed by:* '"$REVIEWER"'\nğŸ“„ *Review State:* '"$REVIEW_STATE"'\nğŸ’¬ *Comments:* '"$REVIEW_BODY"'\nğŸ”— *PR Link:* '"$PR_URL"'"
          }' "$SLACK_WEBHOOK_URL"
